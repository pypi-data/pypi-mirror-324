import{u as T,Q as M}from"./use-meta-bO_iFVqN.js";import{u as B}from"./use-quasar-DudLWLP0.js";import{u as R,Q as p}from"./token-DsdsNIzv.js";import{a as $,r as c,o as S,w as b,a5 as x,a6 as V,a9 as n,aa as s,J as k,ac as m,a8 as i,ab as g,ag as u,a7 as w,ay as W,aL as F,ak as K,at as E,e as H,ae as J}from"./index-DPOJo1e5.js";import{Q as X}from"./QBtnGroup-X84JNz4Y.js";import{a as Y}from"./rtl-agftazR7.js";import{Q as Z,a as ee,b as ae}from"./QTable-vuYj230V.js";import{get as te,post as y}from"./axios-XGsPLS-t.js";import{u as ne}from"./vue-i18n.runtime-BoLl2X9W.js";import"./QItemLabel-BYJX0yHu.js";const oe={class:"q-pa-md"},se={key:0},le={key:1},ie={__name:"UserList",setup(q){const{t:a}=ne(),o=B(),v=R(),C=$(()=>[{name:"username",required:!0,label:a("username"),align:"left",field:"username"},{name:"email",align:"center",label:a("email"),field:"email"},{name:"date_joined",label:a("date_joined"),field:"date_joined"},{name:"last_login",label:a("last_login"),field:"last_login"},{name:"updated_time",label:a("updated_time"),field:"updated_time"},{name:"action",label:a("action"),align:"right"}]),h=$(()=>v.token),d=c([]),P=c([]),Q=c(""),U=c(0),_=c({page:1,rowsPerPage:1,rowsNumber:1}),A=$(()=>h.value!==""?Math.ceil(U.value/_.value.rowsPerPage):0),G=c(o.screen.height*.73+"px"),j=c(o.screen.width*.825+"px"),I=c(o.dark.isActive?"#121212":"#ffffff");function f(l){let t={};l?t=l:t.pagination=_.value,v.userPermissionGet("Get User List")&&(te({url:"core/user/",params:{search:Q.value,page:t.pagination.page,max_page:t.pagination.rowsPerPage}}).then(e=>{d.value=e.results,U.value=e.count,P.value=e.permission}).catch(e=>(o.loading.hide(),Promise.reject(e))),_.value=t.pagination)}function D(l){console.log("pageChange",l)}function L(l){o.dialog({dark:o.dark.isActive,title:a("changepassword"),message:a("changePWD"),prompt:{model:"",isValid:t=>t.length>2,type:"text"},cancel:!0}).onOk(t=>{y("core/user/changepwd/",{id:d.value[l].id,pwd:t}).then(()=>{f()}).catch(e=>{o.notify({type:"error",message:e}),o.loading.hide()})})}function N(l){o.dialog({title:a("permission"),message:a("choosepermission"),options:{type:"checkbox",model:Object.keys(d.value[l].permission),inline:!0,items:P.value},cancel:!0}).onOk(t=>{y("core/user/setpermission/",{id:d.value[l].id,permission:t}).then(()=>{f()}).catch(e=>{o.notify({type:"error",message:e}),o.loading.hide()})})}function z(l){y("core/user/lock/",{id:d.value[l].id}).then(()=>{f()}).catch(t=>{o.notify({type:"error",message:t}),o.loading.hide()})}function O(l){o.dialog({dark:o.dark.isActive,title:a("deleteuser"),message:a("confirmnotice"),cancel:!0}).onOk(()=>{y("core/user/delete/",{id:d.value[l].id}).then(()=>{f()}).catch(t=>{o.notify({type:"error",message:t}),o.loading.hide()})})}return S(()=>{f()}),b(()=>o.dark.isActive,l=>{I.value=l?"#121212":"#ffffff"}),b(()=>_.value,l=>{console.log("watch",l.sortBy)}),b(()=>h.value,l=>{l===""?(d.value=[],U.value=0):f()}),(l,t)=>(x(),V("div",oe,[n(ae,{class:E(i(o).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:d.value,columns:C.value,"row-key":"name",pagination:_.value,separator:"cell","no-data-label":i(a)("nodata"),"rows-per-page-label":i(a)("per_page"),"rows-per-page-options":[1,10,30,50,200,0],"table-style":{height:G.value,width:j.value},"card-style":{backgroundColor:I.value},onRequest:f},{top:s(e=>[n(X,{flat:""},{default:s(()=>[k(n(m,{label:i(a)("refresh"),icon:"refresh",onClick:t[0]||(t[0]=r=>f())},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),[[w,i(v).userPermissionGet("Get User List")]]),k(n(m,{label:i(a)("new"),icon:"add"},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("newUser")),1)]),_:1})]),_:1},8,["label"]),[[w,i(v).userPermissionGet("Create One User")]])]),_:1}),n(Y),n(W,{dense:"",debounce:"300",color:"primary",modelValue:Q.value,"onUpdate:modelValue":t[1]||(t[1]=r=>Q.value=r),onInput:t[2]||(t[2]=r=>f()),onKeyup:t[3]||(t[3]=F(r=>f(),["enter"]))},{append:s(()=>[n(K,{name:"search"})]),_:1},8,["modelValue"]),n(m,{flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":s(e=>[n(Z,{props:e},{default:s(()=>[e.col.name==="action"?(x(),V("div",se,[n(m,{round:"",flat:"",icon:"published_with_changes",onClick:r=>L(e.rowIndex)},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),n(m,{round:"",flat:"",icon:"admin_panel_settings",onClick:r=>N(e.rowIndex)},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("permission")),1)]),_:1})]),_:2},1032,["onClick"]),k(n(m,{round:"",flat:"",icon:"lock_person",onClick:r=>z(e.rowIndex)},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[w,!e.row.is_active]]),k(n(m,{round:"",flat:"",icon:"lock_open",onClick:r=>z(e.rowIndex)},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[w,e.row.is_active]]),n(m,{round:"",flat:"",icon:"delete_sweep",onClick:r=>O(e.rowIndex)},{default:s(()=>[n(p,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(i(a)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"])])):(x(),V("div",le,u(e.value),1))]),_:2},1032,["props"])]),pagination:s(e=>[g(u(i(a)("total"))+u(A.value)+" "+u(i(a)("page"))+" ",1),n(ee,{modelValue:e.pagination.page,"onUpdate:modelValue":[r=>e.pagination.page=r,r=>D(e)],max:e.pagesNumber,input:"","input-class":"text-orange-10"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},he={__name:"UserReader",setup(q){const a=B(),o=c(!1),v=c(""),C=c(""),h=c("");return T(()=>({title:v.value,meta:{description:{name:"description",content:C.value},keywords:{name:"keywords",content:h.value}}})),S(()=>{}),H(()=>{}),b(()=>a.dark.isActive,d=>{o.value=d}),(d,P)=>(x(),J(M,{class:"flex flex-top"},{default:s(()=>[n(ie)]),_:1}))}};export{he as default};
