import{u as F,Q as M}from"./use-meta-BJf22G_X.js";import{u as I}from"./use-quasar-C4dEIvq7.js";import{u as R,Q as k}from"./token-LfB2l9-T.js";import{a as Q,r,o as S,w as z,a5 as x,a6 as $,a9 as o,aa as i,J as _,ac as g,a8 as s,ab as v,ag as u,a7 as h,ay as W,aL as E,ak as K,at as H,e as J,ae as X}from"./index-DyrRxIza.js";import{Q as Y}from"./QBtnGroup-C-nPWJM1.js";import{a as Z}from"./rtl-Di31gjcL.js";import{Q as ee,a as te,b as ae}from"./QTable-oAmVPKCK.js";import{e as ne,g as oe,p as y}from"./axios-Uf4kWBFs.js";import{u as se}from"./vue-i18n.runtime-BR2nLs-2.js";import"./QItemLabel-Cqwpeh6J.js";const ie={class:"q-pa-md"},le={key:0},re={key:1},de={__name:"UserList",setup(L){const{t}=se(),n=I(),d=R(),P=Q(()=>[{name:"username",required:!0,label:t("username"),align:"left",field:"username"},{name:"email",align:"center",label:t("email"),field:"email"},{name:"date_joined",label:t("date_joined"),field:"date_joined"},{name:"last_login",label:t("last_login"),field:"last_login"},{name:"updated_time",label:t("updated_time"),field:"updated_time",sortable:!0},{name:"action",label:t("action"),align:"right"}]),C=Q(()=>d.token),c=r([]),w=r([]),b=r(""),U=r(0),p=r({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),G=Q(()=>C.value!==""?Math.ceil(U.value/p.value.rowsPerPage):0),q=r(n.screen.height*.73+"px"),A=r(n.screen.width*.825+"px"),V=r(n.dark.isActive?"#121212":"#ffffff");function m(l){let e={};l?e=l:e.pagination=p.value,d.userPermissionGet("Get User List")&&(oe({url:"core/user/",params:{search:b.value,ordering:(p.value.descending?"-":"")+p.value.sortBy,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(a=>{a.login||(c.value=a.results,U.value=a.count,w.value=a.permission)}).catch(a=>(n.loading.hide(),Promise.reject(a))),p.value=e.pagination)}function O(){n.dialog({dark:n.dark.isActive,title:t("newUser"),message:t("createuser"),prompt:{model:"",isValid:l=>l.length>2,type:"text"},cancel:!0}).onOk(l=>{y("core/user/create/",{username:l}).then(()=>{m()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}function D(l){n.dialog({dark:n.dark.isActive,title:t("changepassword"),message:t("changePWD"),prompt:{model:"",isValid:e=>e.length>2,type:"text"},cancel:!0}).onOk(e=>{y("core/user/changepwd/",{id:c.value[l].id,pwd:e}).then(()=>{}).catch(a=>{n.notify({type:"error",message:a}),n.loading.hide()})})}function T(l){n.dialog({title:t("permission"),message:t("choosepermission"),options:{type:"checkbox",model:Object.keys(c.value[l].permission),inline:!0,items:w.value},cancel:!0}).onOk(e=>{y("core/user/setpermission/",{id:c.value[l].id,permission:e}).then(()=>{m()}).catch(a=>{n.notify({type:"error",message:a}),n.loading.hide()})})}function B(l){y("core/user/lock/",{id:c.value[l].id}).then(()=>{m()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})}function j(l){n.dialog({dark:n.dark.isActive,title:t("deleteuser"),message:t("confirmnotice"),cancel:!0}).onOk(()=>{y("core/user/delete/",{id:c.value[l].id}).then(()=>{m()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}S(()=>{N(),m()}),z(()=>n.dark.isActive,l=>{V.value=l?"#121212":"#ffffff"});function N(){ne.on("needLogin",l=>{l&&(c.value=[],w.value=[],b.value="",U.value=0)})}return(l,e)=>(x(),$("div",ie,[o(ae,{class:H(s(n).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:c.value,columns:P.value,"row-key":"name",pagination:p.value,"onUpdate:pagination":e[7]||(e[7]=a=>p.value=a),separator:"cell","no-data-label":s(t)("nodata"),"rows-per-page-label":s(t)("per_page"),"rows-per-page-options":[1,10,30,50,200,1e3],"table-style":{height:q.value,width:A.value},"card-style":{backgroundColor:V.value},onRequest:m},{top:i(a=>[o(Y,{flat:""},{default:i(()=>[_(o(g,{label:s(t)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=f=>m())},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),[[h,s(d).userPermissionGet("Get User List")]]),_(o(g,{label:s(t)("new"),icon:"add",onClick:e[1]||(e[1]=f=>O())},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("newUser")),1)]),_:1})]),_:1},8,["label"]),[[h,s(d).userPermissionGet("Create One User")]])]),_:1}),o(Z),o(W,{dense:"",debounce:"300",color:"primary",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=f=>b.value=f),onInput:e[3]||(e[3]=f=>m()),onKeyup:e[4]||(e[4]=E(f=>m(),["enter"]))},{append:i(()=>[o(K,{name:"search"})]),_:1},8,["modelValue"]),o(g,{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":i(a=>[o(ee,{props:a},{default:i(()=>[a.col.name==="action"?(x(),$("div",le,[_(o(g,{round:"",flat:"",icon:"published_with_changes",onClick:f=>D(a.rowIndex)},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),[[h,s(d).userPermissionGet("Change Password")]]),_(o(g,{round:"",flat:"",icon:"admin_panel_settings",onClick:f=>T(a.rowIndex)},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("permission")),1)]),_:1})]),_:2},1032,["onClick"]),[[h,s(d).userPermissionGet("Set Permission For User")]]),_(o(g,{round:"",flat:"",icon:"lock_person",onClick:f=>B(a.rowIndex)},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[h,!a.row.is_active&&s(d).userPermissionGet("Lock & Unlock User")]]),_(o(g,{round:"",flat:"",icon:"lock_open",onClick:f=>B(a.rowIndex)},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[h,a.row.is_active&&s(d).userPermissionGet("Lock & Unlock User")]]),_(o(g,{round:"",flat:"",icon:"delete_sweep",onClick:f=>j(a.rowIndex)},{default:i(()=>[o(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[v(u(s(t)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"]),[[h,s(d).userPermissionGet("Delete One User")]])])):(x(),$("div",re,u(a.value),1))]),_:2},1032,["props"])]),pagination:i(()=>[v(u(s(t)("total"))+u(G.value)+" "+u(s(t)("page"))+" ",1),o(te,{modelValue:p.value.page,"onUpdate:modelValue":[e[5]||(e[5]=a=>p.value.page=a),e[6]||(e[6]=a=>m())],max:G.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},ye={__name:"UserReader",setup(L){const t=I(),n=r(!1),d=r(""),P=r(""),C=r("");return F(()=>({title:d.value,meta:{description:{name:"description",content:P.value},keywords:{name:"keywords",content:C.value}}})),S(()=>{}),J(()=>{}),z(()=>t.dark.isActive,c=>{n.value=c}),(c,w)=>(x(),X(M,{class:"flex flex-top"},{default:i(()=>[o(de)]),_:1}))}};export{ye as default};
