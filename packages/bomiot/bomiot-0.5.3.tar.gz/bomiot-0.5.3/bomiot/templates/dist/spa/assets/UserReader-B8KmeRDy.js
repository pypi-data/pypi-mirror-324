import{u as M,Q as R}from"./use-meta-Z1MDJpib.js";import{u as z}from"./use-quasar-DWkU2w26.js";import{u as W,Q as v}from"./token-DtWWh8Zy.js";import{a as U,r as c,o as S,w as q,a5 as x,a6 as $,a9 as n,aa as s,J as w,ac as m,a8 as l,ab as g,ag as u,a7 as b,ay as E,aL as F,ak as K,at as H,e as J,ae as X}from"./index-C7pXybYS.js";import{Q as Y}from"./QBtnGroup-Cc79H6eP.js";import{a as Z}from"./rtl-BQ67P3AT.js";import{Q as ee,a as ae,b as te}from"./QTable-iAdjyLE6.js";import{e as ne,g as oe,p as y}from"./axios-C3xz0f4C.js";import{u as se}from"./vue-i18n.runtime-DC1bIb4D.js";import"./QItemLabel-BPhl1XWf.js";const ie={class:"q-pa-md"},le={key:0},re={key:1},ce={__name:"UserList",setup(B){const{t:a}=se(),o=z(),p=W(),C=U(()=>[{name:"username",required:!0,label:a("username"),align:"left",field:"username"},{name:"email",align:"center",label:a("email"),field:"email"},{name:"date_joined",label:a("date_joined"),field:"date_joined"},{name:"last_login",label:a("last_login"),field:"last_login"},{name:"updated_time",label:a("updated_time"),field:"updated_time"},{name:"action",label:a("action"),align:"right"}]),P=U(()=>p.token),d=c([]),_=c([]),k=c(""),Q=c(0),h=c({page:1,rowsPerPage:1,rowsNumber:1}),G=U(()=>P.value!==""?Math.ceil(Q.value/h.value.rowsPerPage):0),A=c(o.screen.height*.73+"px"),D=c(o.screen.width*.825+"px"),V=c(o.dark.isActive?"#121212":"#ffffff");function f(i){let t={};i?t=i:t.pagination=h.value,p.userPermissionGet("Get User List")&&(oe({url:"core/user/",params:{search:k.value,page:t.pagination.page,max_page:t.pagination.rowsPerPage}}).then(e=>{d.value=e.results,Q.value=e.count,_.value=e.permission}).catch(e=>(o.loading.hide(),Promise.reject(e))),h.value=t.pagination)}function L(i){console.log("pageChange",i)}function T(i){o.dialog({dark:o.dark.isActive,title:a("changepassword"),message:a("changePWD"),prompt:{model:"",isValid:t=>t.length>2,type:"text"},cancel:!0}).onOk(t=>{y("core/user/changepwd/",{id:d.value[i].id,pwd:t}).then(()=>{f()}).catch(e=>{o.notify({type:"error",message:e}),o.loading.hide()})})}function j(i){o.dialog({title:a("permission"),message:a("choosepermission"),options:{type:"checkbox",model:Object.keys(d.value[i].permission),inline:!0,items:_.value},cancel:!0}).onOk(t=>{y("core/user/setpermission/",{id:d.value[i].id,permission:t}).then(()=>{}).catch(e=>{o.notify({type:"error",message:e}),o.loading.hide()})})}function I(i){y("core/user/lock/",{id:d.value[i].id}).then(()=>{f()}).catch(t=>{o.notify({type:"error",message:t}),o.loading.hide()})}function N(i){o.dialog({dark:o.dark.isActive,title:a("deleteuser"),message:a("confirmnotice"),cancel:!0}).onOk(()=>{y("core/user/delete/",{id:d.value[i].id}).then(()=>{f()}).catch(t=>{o.notify({type:"error",message:t}),o.loading.hide()})})}S(()=>{O(),p.tokenDataGet!==""&&f()}),q(()=>o.dark.isActive,i=>{V.value=i?"#121212":"#ffffff"});function O(){ne.on("needLogin",i=>{i&&(d.value=[],_.value=[],k.value="",Q.value=0)})}return(i,t)=>(x(),$("div",ie,[n(te,{class:H(l(o).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:d.value,columns:C.value,"row-key":"name",pagination:h.value,separator:"cell","no-data-label":l(a)("nodata"),"rows-per-page-label":l(a)("per_page"),"rows-per-page-options":[1,10,30,50,200,0],"table-style":{height:A.value,width:D.value},"card-style":{backgroundColor:V.value},onRequest:f},{top:s(e=>[n(Y,{flat:""},{default:s(()=>[w(n(m,{label:l(a)("refresh"),icon:"refresh",onClick:t[0]||(t[0]=r=>f())},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),[[b,l(p).userPermissionGet("Get User List")]]),w(n(m,{label:l(a)("new"),icon:"add"},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("newUser")),1)]),_:1})]),_:1},8,["label"]),[[b,l(p).userPermissionGet("Create One User")]])]),_:1}),n(Z),n(E,{dense:"",debounce:"300",color:"primary",modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=r=>k.value=r),onInput:t[2]||(t[2]=r=>f()),onKeyup:t[3]||(t[3]=F(r=>f(),["enter"]))},{append:s(()=>[n(K,{name:"search"})]),_:1},8,["modelValue"]),n(m,{flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen",onClick:e.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":s(e=>[n(ee,{props:e},{default:s(()=>[e.col.name==="action"?(x(),$("div",le,[n(m,{round:"",flat:"",icon:"published_with_changes",onClick:r=>T(e.rowIndex)},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),n(m,{round:"",flat:"",icon:"admin_panel_settings",onClick:r=>j(e.rowIndex)},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("permission")),1)]),_:1})]),_:2},1032,["onClick"]),w(n(m,{round:"",flat:"",icon:"lock_person",onClick:r=>I(e.rowIndex)},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[b,!e.row.is_active]]),w(n(m,{round:"",flat:"",icon:"lock_open",onClick:r=>I(e.rowIndex)},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[b,e.row.is_active]]),n(m,{round:"",flat:"",icon:"delete_sweep",onClick:r=>N(e.rowIndex)},{default:s(()=>[n(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[g(u(l(a)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"])])):(x(),$("div",re,u(e.value),1))]),_:2},1032,["props"])]),pagination:s(e=>[g(u(l(a)("total"))+u(G.value)+" "+u(l(a)("page"))+" ",1),n(ae,{modelValue:e.pagination.page,"onUpdate:modelValue":[r=>e.pagination.page=r,r=>L(e)],max:e.pagesNumber,input:"","input-class":"text-orange-10"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},we={__name:"UserReader",setup(B){const a=z(),o=c(!1),p=c(""),C=c(""),P=c("");return M(()=>({title:p.value,meta:{description:{name:"description",content:C.value},keywords:{name:"keywords",content:P.value}}})),S(()=>{}),J(()=>{}),q(()=>a.dark.isActive,d=>{o.value=d}),(d,_)=>(x(),X(R,{class:"flex flex-top"},{default:s(()=>[n(ce)]),_:1}))}};export{we as default};
