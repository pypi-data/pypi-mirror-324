version: '3'

tasks:
  lint:
    desc: Run Ruff linter on all Python files (using ruff.toml config)
    cmds:
      - ruff check 

  lint:fix:
    desc: Run Ruff linter with auto-fix on all Python files
    cmds:
      - ruff check --fix 

  format:
    desc: Run Ruff formatter on all Python files
    cmds:
      - ruff format 

  check:all:
    desc: Run both linter and formatter in check mode (no changes)
    cmds:
      - ruff check 
      - ruff format --check 

  fix:all:
    desc: Run both linter and formatter with fixes
    cmds:
      - ruff check --fix 
      - ruff format 

  watch:
    desc: Run Ruff in watch mode to check files on change
    cmds:
      - ruff check --watch 

  test:
    desc: Run pytest
    cmds:
      - uv run pytest -v -c server/pytest.ini
  
  test:watch:
    desc: Run pytest in watch mode
    cmds:
      - uv run ptw . -c server/pytest.ini -v

  batch_caption:
    desc: Run batch_caption on example images
    cmds:
      - uv run python ./graphcap/main.py batch-caption ../datasets/os_img --provider gemini --output ../datasets/os_img/output.jsonl -t graph -c ../provider.config.toml

  export_dataset:local:
    desc: Export example dataset locally with relative paths
    cmds:
      - uv run python ./graphcap/main.py export-dataset ../datasets/os_img/output.jsonl --name "gc-os-img" --description "Example gc dataset" --local-only

  export_dataset:hf:
    desc: Push example dataset to Hugging Face Hub with HF URLs
    cmds:
      - uv run python ./graphcap/main.py export-dataset ../datasets/os_img/output.jsonl --name "gc-os-img" --description "Example gc dataset" --push-to-hub --use-hf-urls