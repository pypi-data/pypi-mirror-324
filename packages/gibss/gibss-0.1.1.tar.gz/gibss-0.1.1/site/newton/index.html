<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Newton - GIBSS</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Newton";
        var mkdocs_page_input_path = "newton.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> GIBSS
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Newton</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#motivation">Motivation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-newton-optimizer">The Newton optimizer.</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#small-negative-values-of-gamma">Small, negative values of \(\gamma\).</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#a-comment-on-numerical-issues">A comment on numerical issues</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../additive/">Additive</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logistic_susie/">Logistic SuSiE</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">GIBSS</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Newton</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="newtons-method-in-jax">Newton's method in JAX</h1>
<h2 id="motivation">Motivation</h2>
<p>In order to apply GIBSS you need to provide a univariate regression function that returns, at a minimum, a Bayes factor and a point estimate of the predictions for each observation.
We use GIBSS to do Bayesian variable selection in logistic regression or Cox regression.
In both these examples (and GLMs more generally) the univariate regression problems are convex.</p>
<p>We make the process of implementing new models in GIBSS simple. We implement a Newton's method with backgracking line search in JAX. 
By providing a an implementation of the objective function in JAX, and utilizing JAXs automatic differentiation and vectorization features,
GIBSS automates the implementation of of the single effect regression by first computing the MAP estimate for each variable, and then approximating the Bayes factor via Gauss-Hermite quadrature. </p>
<h2 id="the-newton-optimizer">The Newton optimizer.</h2>
<p>We use JAX to implement a simple, light weight newton optimizer. 
At a high level, the optimizer takes a function to be minimzed, uses JAX to compute the gradient and hessian,
and performs newton steps. 
For convex objectives, the newton <em>direction</em> is guarunteed to be a descent direction, meaning that there is a stepsize such that <span class="arithmatex">\(x_{t+1} = x_t - \beta H_t^{-1}g_t\)</span> will decrease the objective function. We start with a step size of <span class="arithmatex">\(1\)</span> and decay geometrically by a factor <span class="arithmatex">\(\alpha \in (0, 1)\)</span> until the function achieved a <em>sufficient decrease</em>. That means we require <span class="arithmatex">\(f(x_{t+1}) &lt; f(x_t) - \gamma ||g||_2^2\)</span>. </p>
<p>The two parameters controlling the behavior of the optimizer are <code>alpha</code>, which control the decay of the stepsize in the backtracking line search, and <code>gamma</code> which controls the decrease criteria of accepting a proposed move. Selecting <span class="arithmatex">\(\gamma = -\inf\)</span> corresponds with always accepting the move. When a convex optimization problem is initialized sufficiently close to its optimum it can be shown that a step size of <span class="arithmatex">\(\beta = 1\)</span> is always decreasing. However, when initialzed far from the optimum there is no guaruntee. </p>
<h3 id="small-negative-values-of-gamma">Small, negative values of <span class="arithmatex">\(\gamma\)</span>.</h3>
<p>In practice we find that due to numerical stablity issues can cause updates to slightly increase the objective, while substantially decreasing Newton's decrement, which provides an upper bound on the suboptimality of the solution. We monitor convergence by Newton's decrement, so we find it useful to set <code>gamma</code> to a small negative value, e.g. <span class="arithmatex">\(0.1\)</span>. In practice, we find this prevents us from divergent behavior at poor initialization, without causing the algorithm to stall.</p>
<h3 id="a-comment-on-numerical-issues">A comment on numerical issues</h3>
<p>JAX JIT compiler is known to change the numeric output of comptutations. 
That is, the JIT compiled version of a function might produce slightly different output compared to the original function. 
This is due to the fact that floating point airthmatic is only an approximation of regular arithmetic, 
and clever optimizations made by the compiler might change the sequence of operations the machine carries out.
In practice, we find that even extremely small steps in the descent direction can apprently <em>increase</em> the objective by a small amount, while dramatically decreasing an upper bound/approximation to the sub-optimality. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../additive/" class="btn btn-neutral float-right" title="Additive">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../additive/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascripts/mathjax.js"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
