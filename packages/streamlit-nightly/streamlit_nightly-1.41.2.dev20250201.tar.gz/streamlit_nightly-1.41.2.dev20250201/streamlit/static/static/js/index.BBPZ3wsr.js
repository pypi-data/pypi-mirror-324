import{r as l,E as R,_ as M,n as g,C as he,y as J,j as a,bd as q,bw as fe,z as I,br as Q,b9 as Z,bq as E,b3 as me,bH as ye,bI as S,bu as ve,aY as X,bl as Ce,bJ as Ie,J as L,F as G,bn as be,bm as we}from"./index.B7J6suR-.js";import{g as xe,F as Se,C as Fe,I as Ee,E as ze,u as Ue,a as He}from"./FileDropzone.B8wCqKiM.js";import{I as Te}from"./InputInstructions.qlsk9gvt.js";import{i as De}from"./inputUtils.CQWz5UKz.js";import{U as k}from"./UploadFileInfo.C-jY39rj.js";import{T as Le}from"./textarea.CUrV8-V3.js";import"./base-input.DyTEaESI.js";var ee=l.forwardRef(function(e,t){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(R,M({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),l.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),l.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});ee.displayName="AttachFile";var te=l.forwardRef(function(e,t){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(R,M({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),l.createElement("path",{d:"M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))});te.displayName="ErrorOutline";var oe=l.forwardRef(function(e,t){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(R,M({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),l.createElement("rect",{width:24,height:24,fill:"none"}),l.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});oe.displayName="Send";const Be=g("div",{target:"epbvcmu0"})(({theme:e,width:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.transparent,borderRadius:e.radii.chatInput,display:"flex",backgroundColor:e.colors.widgetBackgroundColor??e.colors.secondaryBg,width:`${t}px`,overflow:"hidden",":focus-within":{borderColor:e.colors.primary},"&.dropzone":{borderColor:e.colors.primary,borderRadius:e.radii.full,height:e.sizes.emptyDropdownHeight}})),Ve=g("div",{target:"epbvcmu1"})(({theme:e})=>({position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:e.spacing.lg,gap:e.spacing.sm})),ke=g("button",{target:"epbvcmu2"})(({theme:e,disabled:t,extended:s})=>{const h=he(e),[y,p]=h?[e.colors.gray60,e.colors.gray80]:[e.colors.gray80,e.colors.gray40];return{border:"none",backgroundColor:e.colors.transparent,borderTopRightRadius:s?"0":e.radii.chatInput,borderTopLeftRadius:s?e.radii.default:"0",borderBottomRightRadius:e.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeights.none,margin:e.spacing.none,padding:e.spacing.sm,color:t?y:p,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:h?e.colors.gray10:e.colors.gray90},"&:hover":{color:e.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:e.colors.transparent,borderColor:e.colors.transparent,color:e.colors.gray}}}),Re=g("div",{target:"epbvcmu3"})({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,pointerEvents:"none"}),Me=g("div",{target:"epbvcmu4"})(({theme:e})=>({position:"absolute",bottom:"0px",right:`calc(${e.iconSizes.xl} + 2 * ${e.spacing.sm} + ${e.spacing.sm})`})),Ne=g("div",{target:"e12v7o8j0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",margin:"auto",height:"100%",width:"100%",color:e.colors.primary,fontWeight:e.fontWeights.bold})),Ae=g("div",{target:"e12v7o8j1"})(({})=>({display:"flex",alignItems:"top",height:"100%"})),$e=g("div",{target:"e12v7o8j2"})(({theme:e})=>({marginTop:"0.625em",marginLeft:e.spacing.sm,height:e.spacing.xl,width:e.sizes.borderWidth,backgroundColor:e.colors.fadedText20})),je=g("div",{target:"e12v7o8j3"})(({theme:e})=>({left:0,right:0,border:`${e.sizes.borderWidth} solid ${e.colors.transparent}`,minHeight:e.sizes.minChatInputFileListHeight,lineHeight:e.lineHeights.tight,paddingLeft:e.spacing.sm,paddingRight:e.spacing.sm,overflowX:"auto"})),Pe=g("div",{target:"e12v7o8j4"})(({})=>({display:"flex"})),We=g("div",{target:"e12v7o8j5"})(({})=>({flex:"0 0 auto"})),Oe=g("div",{target:"e12v7o8j6"})(({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing.sm,gap:e.spacing.twoXS})),Ke=g("div",{target:"e12v7o8j7"})(({theme:e})=>({color:e.colors.fadedText60})),_e=g("div",{target:"e12v7o8j8"})(({theme:e,fileStatus:t})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t.type==="uploaded"?e.colors.bodyText:e.colors.fadedText60})),Xe=g("div",{target:"e12v7o8j9"})(({theme:e})=>({marginRight:e.spacing.md,color:e.colors.fadedText60})),Ge=g("small",{target:"e12v7o8j10"})(({theme:e})=>({display:"flex",alignItems:"center",maxHeight:e.sizes.smallElementHeight,color:e.colors.fadedText60,"& :hover":{color:e.colors.bodyText}}));function Ye({children:e,content:t}){const s=J();return a(fe,{content:t,placement:q.TOP,overrides:{Body:{style:{top:`-${s.sizes.minElementHeight}`}}},children:e})}const Je=({fileInfo:e})=>{const{type:t}=e.status;switch(t){case"uploading":return a(ye,{usingCustomTheme:!1,"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return a(Ye,{content:e.status.errorMessage,children:a(E,{content:te,size:"lg"})});case"uploaded":return a(E,{content:Ee,size:"lg"});default:return me(t),null}},qe=({fileInfo:e,onDelete:t})=>I(Oe,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[a(Ke,{children:a(Je,{fileInfo:e})}),a(_e,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:e.name,fileStatus:e.status,children:e.name}),a(Xe,{children:xe(e.size,Se.Byte)}),a(Ge,{"data-testid":"stChatInputDeleteBtn",children:a(Q,{onClick:()=>t(e.id),kind:Z.MINIMAL,children:a(E,{content:Fe,size:"lg"})})})]}),Qe=({items:e,onDelete:t})=>a(je,{"data-testid":"stChatUploadedFiles",children:a(Pe,{children:e.map(s=>a(We,{children:a(qe,{fileInfo:s,onDelete:t})},s.id))})}),Ze=({getRootProps:e,getInputProps:t,acceptFile:s,showDropzone:h,disabled:y,theme:p})=>h?I(Ne,{...e(),children:[a("input",{...t()}),"Drag and drop files here"]}):I(Ae,{children:[I("div",{"data-testid":"stChatInputFileUploadButton",...e(),children:[a("input",{...t()}),a(ve,{content:`Upload or drag and drop ${s===S.Multiple?"files":"a file"}`,placement:q.TOP,children:a(Q,{kind:Z.MINIMAL,disabled:y,children:a(E,{content:ee,size:"lg",color:p.colors.fadedText60})})})]}),a($e,{})]}),et=({getNextLocalFileId:e,addFiles:t,updateFile:s,uploadClient:h,element:y,onUploadProgress:p,onUploadComplete:f})=>(v,m)=>{const u=X.CancelToken.source(),d=new k(m.name,m.size,e(),{type:"uploading",cancelToken:u,progress:1});t([d]),h.uploadFile({formId:"",...y},v.uploadUrl,m,c=>p(c,d.id),u.token).then(()=>f(d.id,v)).catch(c=>{X.isCancel(c)||s(d.id,d.setStatus({type:"error",errorMessage:c?c.toString():"Unknown error"}))})},tt=({acceptMultipleFiles:e,uploadClient:t,uploadFile:s,addFiles:h,getNextLocalFileId:y,deleteExistingFiles:p,onUploadComplete:f})=>(v,m)=>{if(!e&&v.length===0&&m.length>1){const u=m.findIndex(d=>{var c;return((c=d.errors)==null?void 0:c[0].code)===ze.TooManyFiles});u>=0&&(v.push(m[u].file),m.splice(u,1))}if(!e&&v.length>0&&p(),t.fetchFileURLs(v).then(u=>{Ce(u,v).forEach(([d,c])=>{s(d,c)})}).catch(u=>{h(v.map(d=>new k(d.name,d.size,y(),{type:"error",errorMessage:u})))}),m.length>0){const u=m.map(d=>new k(d.file.name,d.file.size,y(),{type:"error",errorMessage:d.errors.map(c=>c.message).filter(c=>!!c).join(", ")}));h(u)}f()},ot=6.5,Y=1,B=(e,t,s)=>s.map(h=>h.id===e?t:h),V=(e,t)=>t.find(s=>s.id===e);function ct({width:e,element:t,widgetMgr:s,fragmentId:h,uploadClient:y}){const p=J(),f=l.useRef(null),v=l.useRef(0),m=l.useRef({minHeight:0,maxHeight:0}),[u,d]=l.useState(!1),[c,z]=l.useState(t.default),[U,N]=l.useState(0),[b,w]=l.useState([]),[F,H]=l.useState(!1),x=Ie(t.acceptFile),A=l.useCallback(o=>w(n=>[...n,...o]),[]),$=l.useCallback(o=>{w(n=>{const i=V(o,n);return L(i)?n:(i.status.type==="uploading"&&i.status.cancelToken.cancel(),i.status.type==="uploaded"&&i.status.fileUrls.deleteUrl&&y.deleteFile(i.status.fileUrls.deleteUrl),n.filter(r=>r.id!==o))})},[y]),ne=()=>{const o=b.filter(n=>n.status.type==="uploaded").map(n=>{const{name:i,size:r,status:C}=n,{fileId:ue,fileUrls:ge}=C;return new be({fileId:ue,fileUrls:ge,name:i,size:r})});return new we({uploadedFileInfo:o})},j=()=>v.current++,ae=tt({acceptMultipleFiles:x===S.Multiple,uploadClient:y,uploadFile:et({getNextLocalFileId:j,addFiles:A,updateFile:(o,n)=>{w(i=>B(o,n,i))},uploadClient:y,element:t,onUploadProgress:(o,n)=>{w(i=>{const r=V(n,i);if(L(r)||r.status.type!=="uploading")return i;const C=Math.round(o.loaded*100/o.total);return r.status.progress===C?i:B(n,r.setStatus({type:"uploading",cancelToken:r.status.cancelToken,progress:C}),i)})},onUploadComplete:(o,n)=>{w(i=>{const r=V(o,i);return L(r)||r.status.type!=="uploading"?i:B(r.id,r.setStatus({type:"uploaded",fileId:n.fileId,fileUrls:n}),i)})}}),addFiles:A,getNextLocalFileId:j,deleteExistingFiles:()=>b.forEach(o=>$(o.id)),onUploadComplete:()=>{f.current&&f.current.focus()}}),{getRootProps:re,getInputProps:ie}=Ue({onDrop:ae,multiple:x===S.Multiple,accept:He(t.fileType)}),se=()=>{let o=0;const{current:n}=f;if(n){const i=n.placeholder;n.placeholder="",n.style.height="auto",o=n.scrollHeight,n.placeholder=i,n.style.height=""}return o},P=()=>{if(f.current&&f.current.focus(),!u||t.disabled)return;const o={data:c,fileUploaderState:ne()};s.setChatInputValue(t,o,{fromUi:!0},h),d(!1),w([]),z(""),N(0)},le=o=>{const{metaKey:n,ctrlKey:i,shiftKey:r}=o;De(o)&&!r&&!i&&!n&&(o.preventDefault(),P())},de=o=>{const{value:n}=o.target,{maxChars:i}=t;i!==0&&n.length>i||(z(n),N(se()))};l.useEffect(()=>b.some(o=>o.status.type==="uploading")?d(!1):d(c!==""||b.length>0),[b,c]),l.useEffect(()=>{if(t.setValue){t.setValue=!1;const o=t.value||"";z(o)}},[t]),l.useEffect(()=>{if(f.current){const{offsetHeight:o}=f.current;m.current.minHeight=o,m.current.maxHeight=o*ot}},[f]),l.useEffect(()=>{const o=r=>{var C;r.preventDefault(),r.stopPropagation(),!F&&((C=r.dataTransfer)!=null&&C.types.includes("Files"))&&H(!0)},n=r=>{r.preventDefault(),r.stopPropagation(),F&&(r.clientX<=0&&r.clientY<=0||r.clientX>=window.innerWidth&&r.clientY>=window.innerHeight)&&H(!1)},i=r=>{r.preventDefault(),r.stopPropagation(),F&&H(!1)};return window.addEventListener("dragover",o),window.addEventListener("drop",i),window.addEventListener("dragleave",n),()=>{window.removeEventListener("dragover",o),window.removeEventListener("drop",i),window.removeEventListener("dragleave",n)}},[F]);const{disabled:T,placeholder:W,maxChars:ce}=t,{minHeight:pe,maxHeight:O}=m.current,K=U>0&&f.current?Math.abs(U-pe)>Y:!1,D=x!==S.None&&F,_="stChatInput";return I(G,{children:[x===S.None?null:a(Qe,{items:[...b],onDelete:$}),a(Be,{className:D?`${_} dropzone`:_,"data-testid":"stChatInput",width:e,children:I(Ve,{children:[x===S.None?null:a(Ze,{getRootProps:re,getInputProps:ie,acceptFile:x,showDropzone:D,disabled:T,theme:p}),D?null:I(G,{children:[a(Le,{inputRef:f,value:c,placeholder:W,onChange:de,onKeyDown:le,"aria-label":W,disabled:T,rows:1,overrides:{Root:{style:{minHeight:p.sizes.minElementHeight,outline:"none",border:"none"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{lineHeight:p.lineHeights.inputWidget,"::placeholder":{opacity:"0.7"},height:K?`${U+Y}px`:"auto",maxHeight:O?`${O}px`:"none",paddingLeft:p.spacing.none,paddingBottom:p.spacing.sm,paddingTop:p.spacing.sm,paddingRight:`calc(${p.iconSizes.xl} + 2 * ${p.spacing.sm} + ${p.spacing.sm})`}}}}),e>p.breakpoints.hideWidgetDetails&&a(Me,{children:a(Te,{dirty:u,value:c,maxLength:ce,type:"chat",inForm:!1})}),a(Re,{children:a(ke,{onClick:P,disabled:!u||T,extended:K,"data-testid":"stChatInputSubmitButton",children:a(E,{content:oe,size:"xl",color:"inherit"})})})]})]})})]})}export{ct as default};
