"use strict";(self.webpackChunkjupyter_ruff=self.webpackChunkjupyter_ruff||[]).push([[509],{509:(e,t,o)=>{o.r(t),o.d(t,{default:()=>m});var n=o(209),r=o(123),a=o(310),c=o(920),u=o.n(c),l=o(259);function f(e){return"code"===e?.type&&"text/x-ipython"===e?.mimeType}function i(e,t){try{return e.format(t).trimEnd()}catch{return t}}async function d(e,t){let o=t.context.path;do{o=a.PathExt.dirname(o);const t=await e.serviceManager.contents.get(o).then((e=>e.content));for(const o of[".ruff.toml","ruff.toml","pyproject.toml"]){const n=t.find((e=>e.name===o));if(void 0===n)continue;const r=await e.serviceManager.contents.get(n.path),a=l.parse(r.content);if("pyproject.toml"!==o)return new c.Workspace(a);if(void 0!==s(a))return new c.Workspace(a)}}while(""!==o);return new c.Workspace(c.Workspace.defaultSettings())}function s(e){return e.tool instanceof Object&&e.tool.ruff}const m={id:"jupyter-ruff:plugin",description:"A JupyterLab and Jupyter Notebook extension for formatting code with Ruff.",autoStart:!0,requires:[n.ICommandPalette,r.INotebookTracker],activate:async(e,t,o)=>{await u()();let n=new c.Workspace(c.Workspace.defaultSettings());o.currentChanged.connect((async(t,o)=>{n=await d(e,o)})),e.commands.addCommand("jupyter-ruff:format-cell",{label:"Format Cell Using Ruff",isEnabled:()=>f(o.activeCell?.model),isVisible:()=>!0,execute:function(e){const t=i(n,o.activeCell.model.sharedModel.source);o.activeCell?.model.sharedModel.setSource(t)}}),e.commands.addCommand("jupyter-ruff:format-all-cells",{label:"Format All Cells Using Ruff",isEnabled:()=>!0,isVisible:()=>!0,execute:function(e){const t=o.currentWidget?.content.model?.cells||[];for(const e of t){if(!f(e))continue;const t=i(n,e.sharedModel.source);e.sharedModel.setSource(t)}}});let a=!1;r.NotebookActions.executionScheduled.connect(((e,{cell:t})=>{if(!a)return;if(!f(t.model))return;const o=i(n,t.model.sharedModel.source);t.model.sharedModel.setSource(o)})),e.commands.addCommand("jupyter-ruff:toggle-auto-format",{label:"Toggle Automatic Formatting Using Ruff",isEnabled:()=>!0,isVisible:()=>!0,isToggleable:!0,isToggled:()=>a,execute:function(e){a=!a}}),e.commands.addCommand("jupyter-ruff:reload-configuration",{label:"Reload On-Disk Configuration Files for Ruff",isEnabled:()=>!0,isVisible:()=>!0,execute:async function(t){n=await d(e,o.currentWidget)}}),t.addItem({command:"jupyter-ruff:format-cell",category:"ruff"}),t.addItem({command:"jupyter-ruff:format-all-cells",category:"ruff"}),t.addItem({command:"jupyter-ruff:toggle-auto-format",category:"ruff"}),t.addItem({command:"jupyter-ruff:reload-configuration",category:"ruff"})}}}}]);